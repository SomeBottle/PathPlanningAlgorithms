# Path Planning Algorithms (A*, Jump Point Search)

ç®—æ³•è¯¾ç¨‹ä½œä¸šã€‚  

ä¸»è¦æ˜¯æ¢å¯» A* è·¯å¾„è§„åˆ’ç®—æ³•ï¼Œå’±é™„å¸¦å®ç°äº†ä¸€ä¸‹ JPS ç‰ˆæœ¬çš„ A* ç®—æ³•ï¼Œæ”¯æŒå¯¹è§’éšœç¢ç‰©çš„é˜»å¡å’Œç»•è·¯å¤„ç†ã€‚

* PSï¼šæ‰€æœ‰ä»£ç éƒ½æœ‰è¯¦ç»†æ³¨é‡Šã€‚

è¿˜åˆ«è¯´ï¼Œè·¯å¾„è§„åˆ’çœŸæŒºæœ‰è¶£å§~ (ã€‚ãƒ»âˆ€ãƒ»)ãƒ   

## 0. å±•ç¤ºæŸœ

<video src="./examples/a_star.mp4" controls="controls" width="500" height="300"></video>

<video src="./examples/a_star_jps_detour.mp4" controls="controls" width="500" height="300"></video>



## 1. `./src` ç›®å½•ç»“æ„

```bash
src
â”œâ”€â”€ algorithms # ç®—æ³•å®ç°
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ a_star.py # A* ç®—æ³•
â”‚Â Â  â”œâ”€â”€ a_star_jps.py # A* ç®—æ³• Jump Point Search ç‰ˆ
â”‚Â Â  â”œâ”€â”€ a_star_jps_detour.py # A* ç®—æ³• Jump Point Search ç‰ˆï¼Œæ”¯æŒå¯¹è§’éšœç¢ç»•è·¯
â”‚Â Â  â”œâ”€â”€ a_star_jps_detour_fixed.py # ï¼ˆæœ¬ä»“åº“ä¸­æœ€å¥½çš„ä¸€ç‰ˆç®—æ³•å®ç°ï¼‰A* ç®—æ³• Jump Point Search ç‰ˆï¼Œæ”¯æŒå¯¹è§’éšœç¢ç»•è·¯ï¼Œä¿®æ­£äº†ç»•è·¯åçš„æœç´¢ç­–ç•¥ï¼Œèƒ½è§£å¾—å’Œ A* ä¸€æ ·çš„è·¯å¾„ä»£ä»·ã€‚
â”‚Â Â  â”œâ”€â”€ a_star_jps_detour_failed.py # å¤±è´¥çš„ç»•è·¯å®ç°
â”‚Â Â  â”œâ”€â”€ algorithm_base.py # ç®—æ³•åŸºç±»
â”‚Â Â  â”œâ”€â”€ states.py # ç®—æ³•çŠ¶æ€æšä¸¾é‡
â”‚Â Â  â””â”€â”€ utils.py # å·¥å…·ç±»ï¼Œä¸»è¦æ˜¯æ–¹å‘ Direction ç›¸å…³çš„ç±»
â”œâ”€â”€ exceptions
â”‚Â Â  â””â”€â”€ __init__.py # ä¸€äº›è‡ªå®šä¹‰å¼‚å¸¸
â”œâ”€â”€ problems
â”‚Â Â  â”œâ”€â”€ __init__.py
â”‚Â Â  â”œâ”€â”€ cell_status.py # å›¾ä¸­æ¯ä¸ªæ ¼å­çŠ¶æ€çš„æšä¸¾é‡
â”‚Â Â  â”œâ”€â”€ drawer.py # é—®é¢˜ç»˜åˆ¶æ¨¡å—
â”‚Â Â  â”œâ”€â”€ generator.py # éšæœºé—®é¢˜ç”Ÿæˆ
â”‚Â Â  â”œâ”€â”€ problem.py # é—®é¢˜ç±»ï¼Œç”¨äºè¡¨ç¤ºæ¯ä¸ªäºŒç»´æ …æ ¼å›¾
â”‚Â Â  â””â”€â”€ utils.py # å·¥å…·æ–¹æ³•
â”œâ”€â”€ test.py # ä¸€äº›æµ‹è¯•ç”¨ä¾‹
â””â”€â”€ visualization
    â”œâ”€â”€ __init__.py
    â”œâ”€â”€ algo_animator.py # ç®—æ³•æ‰§è¡Œè¿‡ç¨‹åŠ¨ç”»åŒ–æ¨¡å—
    â”œâ”€â”€ problem_visualizer.py # å°†é—®é¢˜è¿›è¡Œå¯è§†åŒ–çš„æ¨¡å—
    â”œâ”€â”€ result_visualizer.py # å°†æ±‚è§£ç»“æœè¿›è¡Œå¯è§†åŒ–çš„æ¨¡å—
    â””â”€â”€ utils.py # å¯è§†åŒ–ç›¸å…³çš„å·¥å…·æ–¹æ³•
```

å„ä¸ªæ–¹æ³•çš„è°ƒç”¨æ–¹å¼å¯ä»¥å‚è€ƒ `test.py` ä»¥åŠå„ä¸ªæ–¹æ³•çš„ docstring æ³¨é‡Šã€‚  

## 2. ä¸€äº›ä¸ªäººå¿ƒå¾—

### 2.1. æ¢³ç†ä¸€ä¸‹

Dijkstra ç®—æ³•æ¯æ¬¡è¿­ä»£ä¸­éƒ½ä¼šä»ç›®å‰**æœªç¡®å®šç»“ç‚¹ä¸­é€‰æ‹©è·¯å¾„æœ€çŸ­çš„ç»“ç‚¹**ä½œä¸ºä¸‹ä¸€ä¸ªè½è„šç‚¹ï¼Œç„¶åå†æ‰©å±•å…¶æ‰€æœ‰çš„å¯è¡Œé‚»å±…ç»“ç‚¹ã€‚è™½ç„¶ Dijkstra èƒ½**ä¿è¯æ‰¾åˆ°æœ€çŸ­è·¯**ï¼Œä½†æ˜¯å› ä¸ºå…¶æ‰©å±•çš„é€Ÿåº¦ç‰¹åˆ«æ…¢ï¼Œä¼šå‡åŒ€åœ°æ¢ç´¢å„ä¸ªè·¯å¾„ï¼Œå¯¹äºè§„æ¨¡å¾ˆå¤§çš„å›¾ï¼Œæ±‚è§£é€Ÿåº¦å®åœ¨æ˜¯ä»¤äººä¸æ•¢æ­ç»´ã€‚

* æ³¨æ„ï¼ŒDijkstra **è¦æ±‚è¾¹æƒéè´Ÿ**ã€‚

A* ç®—æ³•åˆ™æ˜¯åœ¨ Dijkstra çš„åŸºç¡€ä¸Šï¼ŒåŠ å…¥äº†å¯å‘å¼ä¿¡æ¯ï¼ˆè¿™ä¸ªä¿¡æ¯å°±æ˜¯â€œ**æ˜¯å¦æ²¿ç€è¿™ä¸ªæ–¹å‘æ›´æœ‰å¯èƒ½å¿«é€Ÿåˆ°è¾¾ç»ˆç‚¹**â€ï¼‰ï¼Œä½¿å¾—å…¶èƒ½å¤Ÿ**ä¼˜å…ˆæ‰©å±•æ›´æœ‰å¸Œæœ›çš„ç»“ç‚¹**ï¼Œä»è€Œ**åŠ é€Ÿæœç´¢è¿‡ç¨‹**ã€‚

* A* ç®—æ³•çš„æ€§èƒ½å› æ­¤ä¹Ÿå–å†³äºå¯å‘å¼ä¿¡æ¯çš„è®¡ç®—æ–¹å¼ï¼ˆ**ä¸ä¸€å®šèƒ½æ‰¾åˆ°æœ€ä¼˜è·¯çº¿**ï¼‰ï¼Œåœ¨éšœç¢ç‰©æ¯”è¾ƒå¤æ‚æ—¶å¯èƒ½æ€§èƒ½ä¸Šä¼šé€€åŒ–åˆ° Dijkstraã€‚  

Jump Point Search ä¼˜åŒ–çš„ A* ç®—æ³•åˆ™è¦å‰å®³å¤šäº†ï¼Œå…¶é€šè¿‡ä¸€äº›ç­–ç•¥å¤§å¹…å‡å°‘äº†**éœ€è¦æ‰©å±•çš„ç»“ç‚¹**æ•°é‡ï¼Œæ¯æ¬¡æ‰©å±•çš„ç»“ç‚¹æ˜¯ä¸€ä¸ªâ€œè·³ç‚¹â€ã€‚

----

ğŸ’¡ ä»ä¸Šé¢ä¹Ÿå¯ä»¥çœ‹å‡ºæ¥ï¼Œè·¯å¾„è§„åˆ’ç®—æ³•åœ¨æ€§èƒ½æ–¹é¢ä¸€ä¸ªå¾ˆé‡è¦çš„ç‚¹å°±æ˜¯â€”â€”**æ‰©å±•ç»“ç‚¹çš„ç­–ç•¥**ã€‚

* æ‰©å±•ç»“ç‚¹æ¢ä¸ªè¯´æ³•ï¼Œå…¶å®å°±æ˜¯ç¨‹åºè®¤ä¸º**å¯èƒ½å­˜åœ¨äºæœ€ä¼˜è·¯å¾„ä¸Šçš„ç»“ç‚¹**ã€‚ç¨‹åºä¼šä»è¿™äº›ç»“ç‚¹å‡ºå‘å¯»æ‰¾ä¸‹ä¸€ä¸ªå¯èƒ½çš„è½è„šç‚¹ã€‚
* å› æ­¤è¿­ä»£è¿‡ç¨‹ä¸­**éœ€è¦æ‰©å±•çš„ç»“ç‚¹è¶Šå°‘**ï¼Œéœ€è¦æ£€æŸ¥çš„ç»“ç‚¹å°±è¶Šå°‘ï¼Œç®—æ³•çš„å†…å­˜æ¶ˆè€—å°±è¶Šå°ï¼ŒåŒæ—¶ä¹Ÿèƒ½æ›´å¿«æ±‚è§£ã€‚

### 2.2. JPS ç®—æ³•ç¢ç¢å¿µ

JPS ä¼˜åŒ–çš„ A* ç®—æ³•ä¸­æœ€é‡è¦çš„ä¸¤ä¸ªæ¦‚å¿µï¼š

1. å¼ºè¿«é‚»å±…
2. è·³ç‚¹

å…·ä½“æ¦‚å¿µçš„ä»‹ç»ä¸å¤šèµ˜è¿°ï¼Œå¯ä»¥è§å‚è€ƒæ–‡ç« ã€‚  

ä¸ªäººè®¤ä¸ºï¼Œè¦æ¸…æ™°åœ°å†™ä»£ç å®ç° JPS-A* ç®—æ³•ï¼Œå¿…é¡»è¦ææ¸…æ¥š JPS çš„æ ¸å¿ƒä¼˜åŒ–ç‚¹åœ¨å“ªé‡Œâ€”â€”  
â€”â€”æ²¡é”™ï¼Œå°±æ˜¯**å¯¹æ‰©å±•ç»“ç‚¹ç­–ç•¥**çš„ä¼˜åŒ–ï¼  

A* ç®—æ³•æ¯ä¸€æ¬¡è¿­ä»£åœ¨å–å‡ºä¸€ä¸ªè½è„šç‚¹åï¼Œéƒ½ä¼š**æ‰©å±•å…¶æ‰€æœ‰é‚»å±…ç»“ç‚¹**ï¼›JPS é¢å¤–å¤šäº†ä¸€äº›è®¡ç®—æ­¥éª¤ï¼Œæ‰¾åˆ°æ‰€è°“çš„â€œè·³ç‚¹â€ï¼Œ**æ‰©å±•çš„æ˜¯è·³ç‚¹è€Œä¸æ˜¯é‚»å±…**ï¼Œè€Œæ¯æ¬¡è¿­ä»£ä¸­æ‰¾åˆ°çš„è·³ç‚¹çš„æ•°é‡è¦æ˜æ˜¾å°‘å¾ˆå¤šï¼Œå› æ­¤æ±‚è§£é€Ÿåº¦æ˜æ˜¾å°±è¦é«˜å¾ˆå¤šã€‚  

ğŸ’¡ ç®€å•æ¥è¯´ï¼ŒJPS ç›¸æ¯” A* ç®—æ³•ï¼Œæ”¹åŠ¨çš„åœ°æ–¹å…¶å®å°±æ˜¯æ‰©å±•ç»“ç‚¹çš„éƒ¨åˆ†ï¼ˆæ¯”å¦‚åœ¨ A* ä¸­å°±æ˜¯å¯»æ‰¾é‚»å±…å¹¶åŠ å…¥ `open_list` è¿™éƒ¨åˆ†ï¼‰ã€‚

## 3. å®¹æ˜“è¢«ç»•è¿›å»çš„åœ°æ–¹

ç®—æ³•å®ç°è¿‡ç¨‹ä¸­æœ€è®©æˆ‘è¿·æƒ‘çš„ä¸€ç‚¹ï¼šå¼ºåˆ¶é‚»å±…ï¼ˆForced Neighborï¼‰åˆ°åº•æ˜¯ä»€ä¹ˆä¸ªåœ°ä½ï¼Ÿ! åˆ°åº•è¦ä¸è¦æŠŠå¼ºåˆ¶é‚»å±…åŠ å…¥ `open_list` ï¼Ÿå¾ˆå¤šæ–‡ç« éƒ½æ²¡è®²æ¸…æ¥šæˆ–æ²¡å¼ºè°ƒè¿™ä¸€ç‚¹ã€‚

æŠ˜è…¾äº†å¥½ä¸€æ®µæ—¶é—´ï¼Œæ€»ç®—æŠŠ JPS ç®—æ³•å®ç°åï¼Œæˆ‘çš„ç­”æ¡ˆæ˜¯ï¼š  

* ä¸éœ€è¦åŠ å…¥ `open_list`ï¼ 

å¼ºåˆ¶é‚»å±…çš„ä½œç”¨ä¸»è¦æœ‰ä¸¤ä¸ªï¼š  

1. ç”¨äºåˆ¤å®šè·³ç‚¹ã€‚ï¼ˆè·³ç‚¹å‘¨å›´è‚¯å®šæœ‰å¼ºåˆ¶é‚»å±…ï¼‰
2. ç”¨äº**å¼•å¯¼æ‰©å±•ç»“ç‚¹**ã€‚

ç¬¬ 1 ç‚¹å¾ˆå¤šæ–‡ç« éƒ½å†™çš„å¾ˆæ˜ç¡®ï¼Œå°±ä¸å¤šèµ˜è¿°äº†ã€‚ä¸»è¦æ˜¯ç¬¬ 2 ç‚¹ã€‚  

> å…³äº JPS ç®—æ³•çš„åŸºç¡€çŸ¥è¯†è¿™é‡Œå’±å°±ä¸å¤šèµ˜è¿°äº†...(âŠ™xâŠ™;)  

### 3.1. å¼ºåˆ¶é‚»å±…æ˜¯æ€ä¹ˆå¼•å¯¼æ‰©å±•ç»“ç‚¹çš„ï¼Ÿ

æˆ‘è§‰å¾—æ•´ä¸ªè¿‡ç¨‹ä¸­æœ€è®©æˆ‘è¿·ç³Šçš„å¯èƒ½å°±æ˜¯è¿™ä¸ªåœ°æ–¹äº†ã€‚  

åœ¨ä» `open_list` å–å‡ºä¸€ä¸ªç»“ç‚¹åï¼Œåœ¨ A* ç®—æ³•ä¸­æœ‰ 8 ä¸ªé‚»å±…ï¼Œè¿™å…¶å®ä¹Ÿå¯ä»¥**çœ‹ä½œæ˜¯ 8 ä¸ªå¯»æ‰¾æ–¹å‘**ï¼Œä½†åœ¨ JPS ç®—æ³•ä¸­ï¼Œå¤§éƒ¨åˆ†æƒ…å†µä¸‹æˆ‘ä»¬å¹¶ä¸éœ€è¦å‘æ‰€æœ‰ 8 ä¸ªæ–¹å‘è¿›è¡Œæœç´¢ã€‚

* è®¾ç»“ç‚¹ $x$ çš„çˆ¶ï¼ˆå‰é©±ï¼‰ç»“ç‚¹æ˜¯ $parent(x)$ï¼Œ**æ‰€è°“çš„â€œæ–¹å‘â€å°±æ˜¯** $parent(x)$ æŒ‡å‘ $x$ çš„è¿™ä¸ªæ–¹å‘ã€‚

![8_directions](./pics/8_directions.png)  
> å›¾ä¸­æ ‡å‡ºæ¥äº† 8 ä¸ªâ€œé‚»å±…â€çš„ä½ç½®ï¼Œåœ¨ JPS ä¸­è¿™æ˜¯ 8 ä¸ªå¯»æ‰¾æ–¹å‘ã€‚  

* ä¸Šå›¾ä¸­æ˜¯ä¸€ä¸ªèµ·å§‹èŠ‚ç‚¹ï¼Œå…¶æ²¡æœ‰çˆ¶ç»“ç‚¹ï¼Œå› æ­¤éœ€è¦å‘ 8 ä¸ªæ–¹å‘å»æŸ¥æ‰¾è·³ç‚¹ï¼Œå°†è·³ç‚¹åŠ å…¥ `open_list`ã€‚  

ä¹Ÿå°±æ˜¯ä» `open_list` å–å‡ºçš„ç¬¬äºŒä¸ªç»“ç‚¹å¼€å§‹ï¼Œ**å°±å…¨éƒ½æ˜¯è·³ç‚¹äº†**ã€‚

> å½“ç„¶ï¼ŒæŠŠèµ·å§‹ç»“ç‚¹çœ‹ä½œè·³ç‚¹ä¹Ÿè¡Œã€‚

æ¯ä¸ªè·³ç‚¹éƒ½æœ‰è·¯å¾„ä¸Šçš„çˆ¶ï¼ˆå‰é©±ï¼‰ç»“ç‚¹ï¼Œæœ‰çˆ¶ç»“ç‚¹çš„ç»“ç‚¹å°±æœ‰æ–¹å‘ã€‚è€Œæœ‰æ–¹å‘ï¼ŒJPS å°±èƒ½é¡ºç€æ–¹å‘æ‰¾è·³ç‚¹ï¼Œæœ‰ä¸¤ç§æƒ…å†µï¼š  

1. **æ°´å¹³/ç«–ç›´æ–¹å‘**ã€‚

    ![move_horizontally](./pics/move_horizontally.png) ![move_horizontally_with_obstacle](./pics/move_horizontally_with_obstacle.png)  

    æ²¿ç€è¿™ä¸ªæ–¹å‘**ä¸€ç›´èµ°**ç›´åˆ°é‡åˆ°ç‰¹å®šçš„ï¼ˆè§å‚è€ƒæ–‡ç« ï¼‰éšœç¢ç‰©ï¼Œå°±æœ‰äº†å¼ºåˆ¶é‚»å±…ï¼ˆç´«è‰²ï¼‰ï¼Œä¹Ÿå°±æ‰¾åˆ°äº†è·³ç‚¹ã€‚

2. **å¯¹è§’æ–¹å‘**ã€‚

    ![move_diagonally](./pics/move_diagonally.png) ![move_diagonally_with_obstacle](./pics/move_diagonally_with_obstacle.png)  

    å…ˆæ²¿ç€æ°´å¹³å’Œç«–ç›´åˆ†é‡æ–¹å‘æŒ‰ 1 è¿›è¡Œï¼Œç„¶åå†æ²¿ç€å¯¹è§’çº¿æ–¹å‘èµ°ä¸€æ­¥ã€‚åå¤è¿™ä¸ªè¿‡ç¨‹ç›´è‡³é‡åˆ°ç‰¹å®šçš„ï¼ˆè§å‚è€ƒæ–‡ç« ï¼‰éšœç¢ç‰©ï¼Œå°±æœ‰äº†å¼ºåˆ¶é‚»å±…ï¼ˆç´«è‰²ï¼‰ï¼Œå°±æ‰¾åˆ°äº†è·³ç‚¹ã€‚

> ç‰¹ä¾‹ï¼šç»ˆç‚¹æ²¡æœ‰å¼ºåˆ¶é‚»å±…ã€‚

æ³¨æ„ï¼Œè¿™é‡Œ**å¼ºåˆ¶é‚»å±…çš„ä½œç”¨**å°±æ¥äº†ï¼  

ä¸Šé¢**æ¯ä¸ªå³å›¾**ä¸­ç»¿è‰²çš„ç»“ç‚¹è‚¯å®šæ˜¯ä» `open_list` ä¸­å–å‡ºçš„è·³ç‚¹ï¼Œå› ä¸ºå…¶æœ‰å¼ºåˆ¶é‚»å±…ï¼ˆç´«è‰²æ–¹å—ï¼‰ï¼Œ**è®¾å…¶ä¸ºç‚¹** $A$ ï¼š

1. å¯¹äº 1 ä¸­çš„æƒ…å†µï¼ŒåŸæœ¬ä» $A$ å‡ºå‘æ‰¾è·³ç‚¹çš„æ–¹å‘æ˜¯ä¸€ç›´å‘å³ï¼Œ**å‡ºç°å¼ºåˆ¶é‚»å±…åï¼Œæ–°å¢äº†ä¸€ä¸ªæŒ‡å‘å¼ºåˆ¶é‚»å±…çš„å¯»æ‰¾æ–¹å‘**ã€‚  

2. å¯¹äº 2 ä¸­çš„æƒ…å†µï¼ŒåŸæœ¬ä» $A$ å‡ºå‘æ‰¾è·³ç‚¹çš„æ–¹å‘æ˜¯ä¸¤ä¸ªåˆ†é‡å’Œä¸€ä¸ªå¯¹è§’æ–¹å‘ï¼Œ**å‡ºç°å¼ºåˆ¶é‚»å±…åï¼Œæ–°å¢äº†ä¸€ä¸ªå¼ºåˆ¶é‚»å±…çš„å¯»æ‰¾æ–¹å‘**ã€‚  

ğŸ’¡ å› æ­¤æ¯æ¬¡å–å‡ºè·³ç‚¹ $A$ åçš„æµç¨‹å¦‚ä¸‹ï¼š

1. è®¡ç®—è¿™ä¸ªè·³ç‚¹ $A$ çš„æ–¹å‘ï¼ˆ $parent(A) \rightarrow A$ çš„è¿™ä¸ªæ–¹å‘ï¼‰ã€‚  
2. å¦‚æœæ˜¯æ°´å¹³/ç«–ç›´æ–¹å‘ï¼Œåˆ™ä» $A$ å‡ºå‘æœ‰ä¸€ä¸ªå¯»æ‰¾æ–¹å‘ï¼›å¦‚æœæ˜¯å¯¹è§’æ–¹å‘ï¼Œåˆ™ä» $A$ å‡ºå‘æœ‰ä¸‰ä¸ªå¯»æ‰¾æ–¹å‘ï¼ˆè§å‚è€ƒæ–‡ç« ï¼‰ã€‚  
3. æ‰«æä¸€åœˆæ£€æŸ¥ $A$ æœ‰å‡ ä¸ªå¼ºåˆ¶é‚»å±…ï¼Œæ¯æ‰¾åˆ°ä¸€ä¸ªå¼ºåˆ¶é‚»å±…ï¼Œå°±åŠ ä¸Šä¸€ä¸ªå¯»æ‰¾æ–¹å‘ã€‚  

    * æ¯ä¸ªç»“ç‚¹æœ€å¤šåªæœ‰ä¸¤ä¸ªå¼ºåˆ¶é‚»å±…ï¼Œæ¯”å¦‚ä¸‹é¢è¿™å¼ å›¾ï¼š

        ![two obstacles](./pics/two_obstacles.png)  

        > è¿™é‡Œå°±æœ‰ $1+2=3$ ä¸ªæ‰¾è·³ç‚¹çš„æ–¹å‘ã€‚  

4. æ²¿ç€è¿™äº›æ–¹å‘å»å¯»æ‰¾è·³ç‚¹ï¼Œå°†æ–°æ‰¾åˆ°çš„è·³ç‚¹åŠ å…¥ `open_list`ï¼Œå†è¿›å…¥ä¸‹ä¸€æ¬¡è¿­ä»£ã€‚  


æ‰€ä»¥è¯´å¼ºåˆ¶é‚»å±…çš„æœ‰å¼•å¯¼è·³ç‚¹æŸ¥æ‰¾çš„åŠŸèƒ½ï¼Œè€Œ JPS æ‰©å±•çš„æ˜¯è·³ç‚¹ï¼Œå› æ­¤å¼ºåˆ¶é‚»å±…å…¶å®å°±æ˜¯åœ¨å¼•å¯¼ç»“ç‚¹çš„æ‰©å±•ã€‚

## 4. å¯¹è§’éšœç¢ç‰©çš„å¤„ç†

### 4.1. åˆæ¢

åˆ›å»ºç®—æ³•å¯¹è±¡çš„æ—¶å€™æœ‰ä¸€ä¸ªå‚æ•° `diagonal_obstacles` å¯ä¾›é…ç½®ï¼Œé»˜è®¤ä¸º `True`ï¼Œå…¶å†³å®šç®—æ³•åœ¨æ‰§è¡Œæœç´¢æ—¶æ˜¯å¦èƒ½ç©¿è¿‡å¯¹è§’éšœç¢ç‰©ï¼Œç±»ä¼¼ä¸‹é¢è¿™äº›æƒ…å†µï¼š  

> Case.1  
> ![diagonal_obstacle_case_1](./pics/diagonal_obstacle_case_1.png)  

> Case.2  
> ![diagonal_obstacle_case_2_1](./pics/diagonal_obstacle_case_2_1.png)  
> ![diagonal_obstacle_case_2_2](./pics/diagonal_obstacle_case_2_2.png) 

âœ¨ å’±ä¹‹æ‰€ä»¥æƒ³åˆ°æ·»åŠ è¿™ä¸ªå‚æ•°ï¼Œæ˜¯å› ä¸ºåœ¨å®é™…åº”ç”¨ä¸­ä¸ºæœºå™¨äººè§„åˆ’è·¯çº¿æ—¶ï¼Œè¿™æ ·æ–œç€ç©¿è¿‡å¯¹è§’éšœç¢ç‰©çš„æƒ…å†µä¼šå¯¼è‡´æœºå™¨äººä¸éšœç¢ç‰©å‘ç”Ÿç¢°æ’ã€‚

* è‹¥ `diagonal_obstacles=True`ï¼Œç¨‹åºä¼šæŠŠè¿™ç§éšœç¢ç‰©è€ƒè™‘åœ¨å†…ï¼Œæœç´¢æ—¶ä¸ä¼šç©¿è¿‡è¿™æ ·çš„éšœç¢ç‰©ã€‚
* è‹¥ `diagonal_obstacles=False`ï¼Œç¨‹åºä¼šå¿½ç•¥è¿™ç§éšœç¢ç‰©ï¼Œæœç´¢æ—¶å°±å¯ä»¥ç›´æ¥ç©¿è¿‡ã€‚  

â— ä½†é—®é¢˜éšä¹‹è€Œæ¥ï¼ŒJPS ç®—æ³•æ˜¯å¾ˆä¾èµ–äºå¯¹è§’æ–¹å‘çš„ç§»åŠ¨çš„ã€‚ä¸Šé¢ Case.1 è™½ç„¶å½±å“ä¸å¤§ï¼Œä½†æ˜¯ Case.2 å¯èƒ½ä¼šä½¿å¾— JPS æ— æ³•æ±‚è§£ï¼Œæ¯”å¦‚ï¼š  

![jps_diagonal_obstacle_case_2](./pics/jps_diagonal_obstacle_case_2.png)  

è¿™ç§æƒ…å†µä¸‹å¾ˆæ˜æ˜¾ JPS åªèƒ½æœç´¢å·¦ä¾§è¿™ä¸€éƒ¨åˆ†ï¼Œè€Œå³ä¾§çš„æœç´¢æ–¹å‘å› ä¸ºæœ‰ Case.2 çš„å¯¹è§’éšœç¢ç‰©ï¼Œå®Œå…¨è¢«å°æ­»äº†ï¼Œå¯¼è‡´ç®—æ³•æ— æ³•æ±‚è§£ã€‚  

### 4.2. ç»•è¿‡å¯¹è§’éšœç¢ç‰©

å¯¹äº Case.2 çš„å¯¹è§’éšœç¢ç‰©ï¼Œæˆ‘å¸Œæœ› JPS ç®—æ³•èƒ½å¤šèµ°å‡ æ­¥ä»¥ç»•è¿‡éšœç¢ç‰©ï¼Œåƒè¿™æ ·ï¼š  

![jps_diagonal_obstacle_case_2_solution](./pics/jps_diagonal_obstacle_case_2_solution.png)  

å®ç°çš„æ—¶å€™æˆ‘**å¹¶æ²¡æœ‰æ”¹å˜ JPS çš„æœç´¢ç­–ç•¥**ï¼ŒJPS ç®—æ³•ä»ç„¶ç»§ç»­æ²¿ç€çº¢è‰²ç®­å¤´è¿™ä¸ªæ–¹å‘æœç´¢è·³ç‚¹ï¼Œå®é™…ä¸Šæˆ‘åªæ˜¯**æš‚æ—¶è®°å½•äº†**çº¢è‰²æ¡†ä»£è¡¨çš„ç»•è·¯ç»“ç‚¹ï¼ˆ[`_add_bypass_pos`](./src/algorithms/a_star_jps_detour.py#L106)ï¼‰å¹¶**ä¿®æ­£äº†åˆ°è¾¾å³ä¸Šè§’çš„è·¯å¾„é•¿åº¦**ï¼ˆ[L296](./src/algorithms/a_star_jps_detour.py#L296), [L370](./src/algorithms/a_star_jps_detour.py#L370)ï¼‰ç½¢äº†ã€‚   

* æ³¨æ„ï¼Œè·¯å¾„é•¿åº¦å¿…é¡»ç«‹å³ä¿®æ­£ï¼Œä¸ç„¶å¯èƒ½å½±å“åˆ°ç®—æ³•çš„æœç´¢è¿‡ç¨‹ã€‚

ğŸ¤” **ä¼šé‡åˆ°ç»•è·¯æƒ…å†µçš„æ“ä½œæœ‰ä¸¤ç§**ï¼š  

1. ä» `open_list` å–å‡ºä¸€ä¸ªç»“ç‚¹åç¡®å®šæœç´¢æ–¹å‘æ—¶ï¼ˆ[`_find_directions`](./src/algorithms/a_star_jps_detour.py#L248)ï¼‰ã€‚  
2. æ²¿ç€æœç´¢æ–¹å‘æŸ¥æ‰¾è·³ç‚¹æ—¶ï¼ˆ[`_jump`](./src/algorithms/a_star_jps_detour.py#L308)ï¼‰ã€‚  

åœ¨ç®—æ³•æ±‚è§£å®Œæˆåï¼Œ**ç”Ÿæˆè·¯å¾„çš„æ—¶å€™ï¼Œå†æŠŠæ‰€æœ‰åœ¨å½•çš„ç»•è·¯ç»“ç‚¹éƒ½åŠ è¿›å»**ï¼ˆ[`solved_path_coordinates`](./src/algorithms/a_star_jps_detour.py#L481)ï¼‰ã€‚  


ğŸ’¡ è¿™éƒ¨åˆ†çš„å®ç°ä½äº `a_star_jps_detour.py` ä¸­ã€‚

ğŸ“ **PS**ï¼šè§‚å¯Ÿåˆ°å¾ˆæœ‰æ„æ€çš„ä¸€ç‚¹ï¼Œå¦‚æœè€ƒè™‘ç»•è¿‡è¿™äº›éšœç¢ç‰©ï¼ŒJPS è§£å‡ºçš„è·¯å¾„ä»£ä»·å’Œ A* å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œ**å¯èƒ½æ˜¯æ¬¡ä¼˜è§£**ï¼›ä½†æ˜¯å¦‚æœä¸è€ƒè™‘å¯¹è§’éšœç¢ç‰©ï¼ŒJPS å’Œ A* è§£å‡ºçš„ä»£ä»·å‡ ä¹æ€»æ˜¯ç›¸åŒçš„ã€‚  

* è¿™å¤§æ¦‚æ˜¯å› ä¸º JPS åœ¨è®¾è®¡ä¹‹åˆå°±å‡è®¾æ˜¯å¯ä»¥æ–œç€ç©¿è¿‡è¿™ç§å¯¹è§’éšœç¢ç‰©ï¼ˆCase.2ï¼‰çš„ï¼Œè€Œæˆ‘è®¾è®¡çš„ç»•è·¯æ–¹å¼æ²¡æœ‰ä¿®æ”¹ç®—æ³•çš„æœç´¢æœºåˆ¶ï¼Œå¯¼è‡´ç®—æ³•æ²¡æœ‰è€ƒè™‘åˆ°æ·»åŠ ç»•è·¯ç»“ç‚¹åå¯èƒ½å­˜åœ¨çš„æ›´ä¼˜çš„å…³é”®ç‚¹ã€‚

### 4.3. ä¿®æ­£ç»•è·¯åçš„æœç´¢ç­–ç•¥

ä¸Šé¢æåˆ°ï¼Œåƒæˆ‘è¿™æ ·çš„ç»•è·¯æœºåˆ¶ï¼ŒJPS å¯èƒ½æ‰¾ä¸åˆ°å’Œ A* ä¸€æ ·çš„ä¼˜è§£ã€‚  

> ![jps_bypass_error](./pics/jps_bypass_error.png)    
> çº¢è‰²å—ä¸º `a_star_jps_detour` æ±‚è§£å¾—åˆ°çš„è·¯çº¿ï¼›é»„è‰²å—ä¸º `open_list` ä¸­çš„ç»“ç‚¹ï¼›ç»¿è‰²å—ä¸º `closed_list` ä¸­çš„ç»“ç‚¹ï¼›é»‘è‰²å—ä¸ºéšœç¢ç‰©ã€‚å›¾ä¸­ç”¨ `#DETOUR` æ ‡å‡ºäº†ç»•è·¯ç»“ç‚¹ã€‚

å›¾ä¸­å®é™…çš„æœ€ä¼˜è·¯å¾„åº”è¯¥æ˜¯è“è‰²ç®­å¤´æ ‡å‡ºçš„è¿™ä¸€æ¡ï¼Œç„¶è€Œç®—æ³•å®é™…çš„æœç´¢æ˜¯æŒ‰é»„è‰²ç®­å¤´æ ‡å‡ºçš„æ–¹å‘è¿›è¡Œçš„ã€‚  

ğŸ¤” ä»å›¾ä¸­æˆ‘å‘ç°ï¼Œå› ä¸ºå‘ç”Ÿäº†ç»•è·¯ï¼Œç®—æ³•åŸæœ¬çš„æœç´¢ç­–ç•¥æ²¡æ³•ä¿è¯æ‰¾åˆ°æœ€ä¼˜è·¯å¾„ã€‚**åº”å½“åœ¨ç»•è·¯ç»“ç‚¹è¿™é‡Œé¢å¤–è¿›è¡Œä¸€äº›æœç´¢**ï¼Œæ¯”å¦‚å›¾ä¸­åœ¨ `#DETOUR_2` è¿™é‡Œéœ€è¦æ²¿ç€è“è‰²æ–œç®­å¤´ï¼ˆå¹³è¡ŒäºåŸæœ¬çš„æœç´¢æ–¹å‘ï¼Œé»„è‰²æ–œç®­å¤´ï¼‰è¿™ä¸ªæ–¹å‘è¿›è¡Œæœç´¢ã€‚  

ğŸ’¡ å› æ­¤ï¼Œéœ€è¦**æŠŠç»•è·¯ç»“ç‚¹ä¹ŸåŠ å…¥** `open_list`ï¼Œå¹¶**å¼ºåˆ¶å…¶æ–¹å‘å¹³è¡ŒäºåŸæœ¬çš„æœç´¢æ–¹å‘**ï¼ˆ[L313](./src/algorithms/a_star_jps_detour_fixed.py#L313)ï¼‰ï¼Œä»¥æ£€æŸ¥å¯èƒ½è¢«å¿½ç•¥çš„å…³é”®ç»“ç‚¹ã€‚   

----

è¯´çš„ç®€å•ï¼Œå®ç°èµ·æ¥è¿˜æ˜¯è¦ç»•å‡ ä¸ªå¼¯å­çš„ã€‚  

è¿é¢è€Œæ¥çš„é—®é¢˜æ˜¯â€”â€”**æ€ä¹ˆç»™ç»•è·¯ç»“ç‚¹æŒ‡å®šçˆ¶ç»“ç‚¹**ï¼Ÿ ï¼ˆè·¯å¾„ä¾é äºçˆ¶ç»“ç‚¹çš„é“¾æ¥æ¥æ„å»ºï¼‰    

1. ä¸Šå›¾ä¸­ `#DETOUR_2` ç»“ç‚¹å·¦ä¾§çš„ç»“ç‚¹æ˜¯ä¸€ä¸ªè·³ç‚¹ï¼Œæ˜¯å®é™…å­˜åœ¨çš„ç»“ç‚¹ï¼Œå¯ä»¥ç›´æ¥å°†å…¶ä½œä¸º `#DETOUR_2` çš„çˆ¶ç»“ç‚¹ã€‚ï¼ˆå¯¹åº” `_find_directions` ä¸­çš„å¤„ç†ï¼‰    
2. åœ¨å¾€ä¸€ä¸ªæ–¹å‘å¯»æ‰¾è·³ç‚¹çš„è¿‡ç¨‹ä¸­ï¼ˆ`_jump` æ–¹æ³•ï¼‰ï¼Œå¦‚æœç¢°åˆ°å¯¹è§’éšœç¢ç‰©ï¼Œå¦‚ä¸‹è¿™ç§æƒ…å†µï¼š  

    > ![jps_bypass_error_2](./pics/jps_bypass_error_2.png)   
    > é»„è‰²ç®­å¤´ä¸ºå…¶ä¸­ä¸€ä¸ªè·³ç‚¹æœç´¢æ–¹å‘ï¼›`#JUMP_POINT` æ ‡è®°çš„ä¸ºè·³ç‚¹ï¼›`#VIRTUAL` æ ‡è®°çš„ä¸ºå®é™…ä¸Šä¸å­˜åœ¨çš„è™šæ‹Ÿç»“ç‚¹ï¼›`#DETOUR` ä¸ºç»•è·¯ç»“ç‚¹ï¼›é»‘è‰²å—ä¸ºéšœç¢ç‰©ï¼›é»„è‰²å—ä¸º `open_list` ç»“ç‚¹ï¼›çº¢è‰²å—ä¸ºæœ€åæ±‚è§£å¾—åˆ°çš„è·¯å¾„ã€‚

    ğŸ’¡ å›¾ä¸­è¿™é‡Œçš„ç»•è·¯ç»“ç‚¹ `#DETOUR` å·¦æ–¹æ˜¯æ²¡æœ‰å®é™…çš„ç»“ç‚¹çš„ï¼Œéœ€è¦åœ¨å…¶å·¦ä¾§æ·»åŠ ä¸€ä¸ªçˆ¶èŠ‚ç‚¹ï¼Œå¹¶å°†è¿™ä¸ªçˆ¶èŠ‚ç‚¹çš„çˆ¶é“¾æ¥è¿æ¥åˆ°è·¯å¾„ï¼ˆé»„è‰²ç®­å¤´è¿™æ¡çº¿ï¼‰ä¸Šçš„ä¸Šä¸€ä¸ªè·³ç‚¹ï¼ˆ[L145](./src/algorithms/a_star_jps_detour_fixed.py#L145)ï¼‰ã€‚  

    è¿™æ ·ä¸€æ¥æœ€åæ‰èƒ½æ­£ç¡®åœ°ç”Ÿæˆè·¯å¾„ã€‚  

## 5. å…¶ä»–éœ€è¦è¯´æ˜çš„åœ°æ–¹

### 5.1. ç”Ÿæˆé—®é¢˜æ—¶å»é™¤å¯¹è§’éšœç¢ç‰©

* `src/problems/generator.py` ä¸­çš„ `generate_partial_ring_problem` æ–¹æ³•
* `src/problems/draw.py` ä¸­çš„ `draw_problem` æ–¹æ³•
* `src/problems/problem.py` ä¸­çš„ `Problem.from_matrix` é™æ€å·¥å‚æ–¹æ³•

ä¸Šé¢å‡ ä¸ªæ–¹æ³•éƒ½æœ‰ä¸€ä¸ª `close_diagonal_obstacles` å‚æ•°ï¼Œé»˜è®¤ä¸º `False`ã€‚  

* å½“è¿™ä¸ªå‚æ•°ä¸º `True` æ—¶ï¼Œä¼šå¯¹å›¾åƒè¿›è¡Œå¹³æ»‘æ“ä½œï¼Œå»é™¤å¯¹è§’éšœç¢ç‰©ï¼Œç¤ºä¾‹å¦‚ä¸‹ï¼š  

    > `close_diagonal_obstacles=False` ï¼ˆé»˜è®¤ï¼‰æ—¶ï¼š  
    > ![diagonal_obstacles_before_close](./pics/diagonal_obstacles_before_close.png)  

    > `close_diagonal_obstacles=True` æ—¶ï¼š  
    > ![diagonal_obstacles_after_close](./pics/diagonal_obstacles_after_close.png)   


ğŸ¤“â˜ï¸ åˆ›å»ºç®—æ³•å¯¹è±¡æ—¶å¦‚æœæŒ‡å®š `diagonal_obstacles=False`ï¼Œç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å°±å¯ä»¥ç©¿è¿‡å¯¹è§’éšœç¢ç‰©ï¼Œè¿™ç§æƒ…å†µä¸‹ä½ å¯ä»¥é¢„å…ˆç”¨ `close_diagonal_obstacles=True` æ¶ˆé™¤æ‰æ‰€æœ‰å¯¹è§’éšœç¢ç‰©ï¼Œæ²¡æœ‰å¯¹è§’éšœç¢ç‰©ï¼Œ`diagonal_obstacles` é€‰é¡¹å…¶å®å°±æ²¡ç”¨äº†ã€‚    



## 6. æ€»ç»“

æœ¬æ¥è¿™åªæ˜¯ä¸ªç®€å•çš„ç®—æ³•è¯¾ç¨‹å¤§ä½œä¸šçš„ï¼Œä½†æ˜¯å½“æˆ‘ç»åŠ²è„‘æ±æŠŠ JPS ç®—æ³•å¤ç°å‡ºæ¥åï¼Œè¿™ä¸ªäº‹æƒ…çš„æ€§è´¨å°±å˜äº†ï¼Œï¼ˆâœ§âˆ€âœ§ï¼‰ğŸ”¥ æˆ‘æŠ˜è…¾é­‚åˆç‡ƒèµ·æ¥äº† ï¼  

äºæ˜¯å°±é¡ºä¾¿æŠŠç»•è·¯å’Œç›¸åº”çš„ä¿®æ­£ç­–ç•¥å®ç°éƒ½å†™äº†ä¸€ä¸‹ï¼Œçœ‹åˆ°è¿™äº›ç®—æ³•èƒ½é¡ºåˆ©è·‘èµ·æ¥ï¼ŒçœŸçš„æ˜¯æˆå°±æ„Ÿæ»¡æ»¡ï¼  


## å‚è€ƒæ–‡çŒ®

* Harabor D, Grastien A. Online graph pruning for pathfinding on grid maps[C]//Proceedings of the AAAI conference on artificial intelligence. 2011, 25(1): 1114-1119.
* DuchoÅˆ F, Babinec A, Kajan M, et al. Path planning with modified a star algorithm for a mobile robot[J]. Procedia engineering, 2014, 96: 59-69.  
* Harabor D. Fast pathfinding via symmetry breaking[J]. Aigamedev Com, 2012.
* https://zerowidth.com/2013/a-visual-explanation-of-jump-point-search/  
* https://hakuya.me/algorithm/findpath/JPS%E7%AE%97%E6%B3%95%E5%88%86%E4%BA%AB/